# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際に Claude Code（claude.ai/code）へのガイダンスを提供します。

## 🎯 大原則

- **日本語で回答してください**
- **エンジニアの時間は貴重** - 可能な限りすべてを自動化
- **プロアクティブアシスタンス** - 求められる前に改善を提案
- **テスト駆動開発で実装してください**
- **自己文書化コード** - 包括的なドキュメントを自動生成
- **エラーファースト思考** - すべてのエッジケースを事前に検討

## 💡 プロアクティブAI改善提案

### すべてのやり取りで時間節約提案を含める

**改善提案フォーマット:**

```
💡 **改善提案**: [簡潔なタイトル]
**節約時間**: 1回につき約X分
**実装**: [簡単なコマンドまたはコードスニペット]
**利点**: [これがコードベースをどのように改善するか]
```

### プロアクティブ分析項目

- 繰り返しコードパターンの識別と抽象化提案
- 潜在的なパフォーマンスボトルネックの早期検出
- 不足しているエラーハンドリングの認識
- 並列化やキャッシュの機会発見
- より慣用的なアプローチの提案

## 🛠️ 開発環境

### 動作確認

**重要**: `npm run dev` は実行しないでください。Dockerコンテナはすでに起動しているため、<http://localhost:3000> にアクセスして動作を確認してください。

### 技術スタック

- **フロントエンド**: Next.js 15（App Router）、React 18、TypeScript
- **UI**: Tailwind CSS、shadcn/ui、Radix UI、Lucide Reactアイコン
- **データベース**: PostgreSQL with Prisma ORM
- **状態管理**: SWR、Zustand
- **テスト**: Vitest, Testing Library
- **バリデーション**: Zod
- **フォーム**: React Hook Form

### 品質管理ツール

```bash
# コードフォーマット（実装後は必須）
npx prettier --write .

# コードリント（実装後は必須）
npm run lint

# 型チェック
npx tsc --noEmit

# テスト実行
npm test -- --coverage
```

## 📁 プロジェクト構造

コードベースは機能ベースのアーキテクチャに従い、クライアントとサーバーコードを明確に分離しています。
テストはコロケーション方式で配置しています。

```
src/
├── app/                    # Next.js App Routerページ
├── client/                 # クライアントサイドコード
│   ├── features/           # 機能固有のコード
│   │   └── recipes/
│   │       ├── components/ # Reactコンポーネント（shadcn/uiベース）
│   │       │   ├── RecipeCard.tsx
│   │       │   ├── RecipeCard.test.tsx
│   │       │   ├── RecipeList.tsx
│   │       │   └── RecipeList.test.tsx
│   │       ├── hooks/      # カスタムフック
│   │       │   ├── useRecipes.ts
│   │       │   └── useRecipes.test.ts
│   │       ├── types/      # TypeScript型定義
│   │       └── utils/      # 機能ユーティリティ
│   │           ├── recipeUtils.ts
│   │           └── recipeUtils.test.ts
│   ├── lib/               # クライアントライブラリ
│   └── shared/            # 共有クライアントユーティリティ
│       ├── api/           # APIリクエストユーティリティ
│       ├── shadcn/        # shadcn UIコンポーネント
│       ├── component/     # カスタムUIコンポーネント
│       └── utils/         # 共有ユーティリティ
├── server/                # サーバーサイドコード
│   ├── features/          # 機能固有のサーバーロジック
│   │   └── recipes/
│   │       └── search/    # レシピ検索機能
│   │           ├── searchService.ts
│   │           └── searchService.test.ts
│   └── shared/            # 共有サーバーユーティリティ
└── db/                    # データベーススキーマとマイグレーション
```

## 🚫 セキュリティと品質標準

### 禁止ルール（非交渉可能）

- **禁止：明示的な確認なしに本番データを削除**
- **禁止：APIキー、パスワード、シークレットのハードコード**
- **禁止：失敗するテストやリンティングエラーを含むコードのコミット**
- **禁止：TypeScript本番コードでの `any` 型使用**

### 必須ルール（必要標準）

- **必須：新機能とバグ修正のテストを書く**
- **必須：実装完了後に `npm run lint` を実行し、通るまで修正**
- **必須：すべてのパブリック関数に包括的なドキュメントを追加**
- **必須：ビジネスロジックを説明する明確なコメントを追加**
- **必須：新しいコードの単体テストを生成**
- **必須：ユーザー入力はZodでバリデーション**

## 🤖 AI駆動コード品質

### ドキュメント＆コード品質要件

- **自動生成：すべての関数に包括的なドキュメント**
- **自動生成：ビジネスロジックを説明する明確なコメント**
- **自動生成：ドキュメントに実用的な例を含める**
- **自動修正：すべてのリンティング/フォーマットの問題**
- **継続的分析：パフォーマンス、セキュリティ、保守性の観点から改善提案**

### コード分析結果フォーマット

```
🔍 コード分析結果:
- パフォーマンス: X件の最適化機会を発見
- セキュリティ: 問題は検出されませんでした / X件の問題を発見
- 保守性: X件のリファクタリングを提案
- テストカバレッジ: X% → X件の追加テストケースを提案
- ドキュメント: X件の関数で適切なドキュメントが不足
```

## ⚡ 効率的なワークフロー

### 探索-計画-コード-コミット

1. **探索フェーズ**: AIでコードベースを迅速にスキャンし要約
2. **計画フェーズ**: 複数の実装アプローチを生成、テストシナリオを自動作成
3. **コードフェーズ**: TDD、包括的ドキュメント、リアルタイムエラー検出
4. **コミットフェーズ**: `npm run lint` → conventional commits → テスト実行

---

**重要**: エンジニアの時間は貴重です。すべてのやり取りで時間を節約し、コード品質を向上させ、プロアクティブに改善を提案してください。
