<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>コーヒーレシピカード - Variation B（最終版）</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-main: #f7f5f2;
        --bg-card: #ffffff;
        --text-primary: #2c2420;
        --text-secondary: #7a6f66;
        --text-muted: #a89f96;
        --border-light: #e8e4df;
        --shadow-soft: 0 2px 8px rgba(44, 36, 32, 0.06);
        --shadow-hover: 0 4px 16px rgba(44, 36, 32, 0.1);
        --shadow-tooltip: 0 4px 12px rgba(44, 36, 32, 0.15);

        --roast-light: #e2b714;
        --roast-medium-light: #c9a227;
        --roast-medium: #a67c52;
        --roast-medium-dark: #7a5a3a;
        --roast-dark: #5c4033;
        --roast-extra-dark: #2d1f1a;
      }

      body {
        font-family: 'Zen Kaku Gothic New', sans-serif;
        background: var(--bg-main);
        color: var(--text-primary);
        line-height: 1.6;
        padding: 40px 20px;
      }

      /* ページヘッダー */
      .page-header {
        max-width: 1200px;
        margin: 0 auto 40px;
        text-align: center;
      }

      .page-title {
        font-size: 1.5rem;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 8px;
      }

      .page-description {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      /* セクション */
      .section {
        max-width: 1200px;
        margin: 0 auto 60px;
      }

      .section__header {
        margin-bottom: 20px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-light);
      }

      .section__title {
        font-size: 1.125rem;
        font-weight: 500;
        color: var(--text-primary);
      }

      .section__description {
        font-size: 0.8125rem;
        color: var(--text-secondary);
        margin-top: 4px;
      }

      /* 区切り線 */
      .divider {
        max-width: 1200px;
        margin: 0 auto 48px;
        border-top: 2px solid var(--border-light);
      }

      /* 焙煎度サンプル用グリッド */
      .roast-samples {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
      }

      /* フィルター表示エリア */
      .filter-bar {
        margin-bottom: 24px;
        min-height: 40px;
      }

      .filter-bar__label {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-bottom: 8px;
      }

      .filter-bar__tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
      }

      .filter-bar__tag {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        padding: 6px 12px;
        border-radius: 100px;
        background: var(--text-primary);
        color: #fff;
        cursor: pointer;
        transition: background 0.2s;
      }

      .filter-bar__tag:hover {
        background: var(--text-secondary);
      }

      .filter-bar__tag-remove {
        font-size: 1rem;
        line-height: 1;
        opacity: 0.7;
      }

      .filter-bar__clear {
        font-size: 0.75rem;
        color: var(--text-muted);
        cursor: pointer;
        text-decoration: underline;
      }

      .filter-bar__clear:hover {
        color: var(--text-secondary);
      }

      .filter-bar--empty {
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        font-size: 0.8125rem;
        border: 1px dashed var(--border-light);
        border-radius: 8px;
        padding: 10px;
      }

      /* 実際の画面用グリッド */
      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
      }

      /* カード */
      .card {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 20px;
        padding-left: 24px;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid var(--border-light);
        position: relative;
      }

      .card::before {
        content: '';
        position: absolute;
        top: -1px;
        left: -1px;
        width: 6px;
        height: calc(100% + 2px);
        border-radius: 12px 0 0 12px;
      }

      .card:hover {
        box-shadow: var(--shadow-hover);
        transform: translateY(-2px);
        z-index: 10;
      }

      .card.is-hidden {
        display: none;
      }

      /* 焙煎度別カラー */
      .card--light::before {
        background: var(--roast-light);
      }
      .card--medium-light::before {
        background: var(--roast-medium-light);
      }
      .card--medium::before {
        background: var(--roast-medium);
      }
      .card--medium-dark::before {
        background: var(--roast-medium-dark);
      }
      .card--dark::before {
        background: var(--roast-dark);
      }
      .card--extra-dark::before {
        background: var(--roast-extra-dark);
      }

      .card__header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
      }

      .card__title {
        font-size: 0.9375rem;
        font-weight: 500;
        line-height: 1.4;
        flex: 1;
        padding-right: 12px;
        min-height: 2.8em;
        max-height: 2.8em;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .card__roast {
        font-size: 0.625rem;
        font-weight: 500;
        padding: 4px 10px;
        border-radius: 4px;
        white-space: nowrap;
        color: #fff;
        flex-shrink: 0;
      }

      .card__roast--light {
        background: var(--roast-light);
      }
      .card__roast--medium-light {
        background: var(--roast-medium-light);
      }
      .card__roast--medium {
        background: var(--roast-medium);
      }
      .card__roast--medium-dark {
        background: var(--roast-medium-dark);
      }
      .card__roast--dark {
        background: var(--roast-dark);
      }
      .card__roast--extra-dark {
        background: var(--roast-extra-dark);
      }

      /* タグ表示（2行固定、溢れた時のみ「他N件」表示） */
      .card__tags-wrapper {
        position: relative;
        min-height: 56px;
      }

      .card__tags-visible {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        max-height: 56px;
        overflow: hidden;
        align-content: flex-start;
      }

      .card__tags-wrapper.has-overflow .card__tags-visible {
        padding-right: 52px;
      }

      .card__tag {
        font-size: 0.6875rem;
        padding: 4px 10px;
        border-radius: 4px;
        background: var(--bg-main);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.15s;
      }

      .card__tag:hover {
        background: var(--text-primary);
        color: #fff;
      }

      .card__expand {
        position: absolute;
        right: 0;
        bottom: 0;
        font-size: 0.6875rem;
        padding: 4px 10px;
        border-radius: 4px;
        background: var(--border-light);
        color: var(--text-muted);
        cursor: pointer;
        white-space: nowrap;
        display: none;
        align-items: center;
        gap: 4px;
        transition: all 0.15s;
      }

      .card__tags-wrapper.has-overflow .card__expand {
        display: inline-flex;
      }

      .card__expand:hover {
        background: var(--text-secondary);
        color: #fff;
      }

      .card__expand.is-open {
        background: var(--text-primary);
        color: #fff;
      }

      .card__expand-icon {
        font-size: 0.5rem;
        transition: transform 0.2s;
      }

      .card__expand.is-open .card__expand-icon {
        transform: rotate(180deg);
      }

      .card__dropdown {
        display: none;
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background: var(--bg-card);
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 12px;
        box-shadow: var(--shadow-tooltip);
        z-index: 100;
      }

      .card__dropdown.is-open {
        display: block;
      }

      .card__dropdown-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      /* フッター（投稿者名） */
      .card__footer {
        margin-top: 12px;
        padding-top: 10px;
        border-top: 1px solid var(--border-light);
      }

      .card__author {
        font-size: 0.75rem;
        color: var(--text-muted);
      }

      /* 結果なしメッセージ */
      .no-results {
        grid-column: 1 / -1;
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
      }

      .no-results__icon {
        font-size: 2rem;
        margin-bottom: 12px;
      }

      .no-results__text {
        font-size: 0.9375rem;
      }
    </style>
  </head>
  <body>
    <header class="page-header">
      <h1 class="page-title">Variation B — 焙煎度アクセント（最終版）</h1>
      <p class="page-description">
        カード幅320px / タイトル2行固定 / タグ2行判定 / 投稿者名は区切り線付き左下
      </p>
    </header>

    <!-- ======================================
       セクション1: 焙煎度ごとのカードサンプル
  ======================================= -->
    <section class="section">
      <div class="section__header">
        <h2 class="section__title">焙煎度ごとのカードサンプル</h2>
        <p class="section__description">6段階の焙煎度それぞれのカラーと見た目</p>
      </div>

      <div class="roast-samples">
        <!-- 浅煎り -->
        <article class="card card--light">
          <div class="card__header">
            <h3 class="card__title">ケニアAAの華やかアロマ</h3>
            <span class="card__roast card__roast--light">浅煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag">フローラル</span>
              <span class="card__tag">ベリー系</span>
              <span class="card__tag">明るい酸味</span>
              <span class="card__tag">華やか</span>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">COFFEE LAB</p>
          </div>
        </article>

        <!-- 中浅煎り -->
        <article class="card card--medium-light">
          <div class="card__header">
            <h3 class="card__title">エチオピア産豆の最適な抽出法</h3>
            <span class="card__roast card__roast--medium-light">中浅煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag">フルーティ</span>
              <span class="card__tag">酸味強め</span>
              <span class="card__tag">シングルオリジン</span>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">鈴木エスプレッソ</p>
          </div>
        </article>

        <!-- 中煎り -->
        <article class="card card--medium">
          <div class="card__header">
            <h3 class="card__title">コロンビアのバランス重視レシピ</h3>
            <span class="card__roast card__roast--medium">中煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag">ナッツ</span>
              <span class="card__tag">キャラメル</span>
              <span class="card__tag">マイルド</span>
              <span class="card__tag">バランス</span>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Morning Brew</p>
          </div>
        </article>

        <!-- 中深煎り -->
        <article class="card card--medium-dark">
          <div class="card__header">
            <h3 class="card__title">ブラジル サントスの甘み引き出す</h3>
            <span class="card__roast card__roast--medium-dark">中深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag">チョコレート</span>
              <span class="card__tag">ほのかな甘み</span>
              <span class="card__tag">コク</span>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Cafe Noir</p>
          </div>
        </article>

        <!-- 深煎り -->
        <article class="card card--dark">
          <div class="card__header">
            <h3 class="card__title">インドネシア マンデリンの深み</h3>
            <span class="card__roast card__roast--dark">深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag">スパイシー</span>
              <span class="card__tag">アーシー</span>
              <span class="card__tag">ボディ強め</span>
              <span class="card__tag">重厚</span>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">珈琲職人</p>
          </div>
        </article>

        <!-- 極深煎り -->
        <article class="card card--extra-dark">
          <div class="card__header">
            <h3 class="card__title">イタリアンローストの極上エスプレッソ</h3>
            <span class="card__roast card__roast--extra-dark">極深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag">スモーキー</span>
              <span class="card__tag">ビター</span>
              <span class="card__tag">濃厚</span>
              <span class="card__tag">エスプレッソ向け</span>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Espresso Master</p>
          </div>
        </article>
      </div>
    </section>

    <div class="divider"></div>

    <!-- ======================================
       セクション2: 実際の画面イメージ
  ======================================= -->
    <section class="section">
      <div class="section__header">
        <h2 class="section__title">実際の画面をイメージしたサンプル</h2>
        <p class="section__description">
          タグをクリックで絞り込み / 「他N件」をクリックで残りタグを表示
        </p>
      </div>

      <!-- フィルターバー -->
      <div class="filter-bar" id="filterBar">
        <div class="filter-bar--empty">タグをクリックして絞り込み</div>
      </div>

      <!-- カード一覧 -->
      <div class="card-grid" id="cardGrid">
        <article class="card card--medium-light" data-tags="フルーティ,酸味強め,シングルオリジン">
          <div class="card__header">
            <h3 class="card__title">エチオピア産豆の最適な抽出法</h3>
            <span class="card__roast card__roast--medium-light">中浅煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="フルーティ">フルーティ</span>
              <span class="card__tag" data-tag="酸味強め">酸味強め</span>
              <span class="card__tag" data-tag="シングルオリジン">シングルオリジン</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">鈴木エスプレッソ</p>
          </div>
        </article>

        <article
          class="card card--dark"
          data-tags="スパイシー,アーシー,ボディ強め,重厚,深い苦味,複雑な香り"
        >
          <div class="card__header">
            <h3 class="card__title">インドネシア マンデリンの深み</h3>
            <span class="card__roast card__roast--dark">深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="スパイシー">スパイシー</span>
              <span class="card__tag" data-tag="アーシー">アーシー</span>
              <span class="card__tag" data-tag="ボディ強め">ボディ強め</span>
              <span class="card__tag" data-tag="重厚">重厚</span>
              <span class="card__tag" data-tag="深い苦味">深い苦味</span>
              <span class="card__tag" data-tag="複雑な香り">複雑な香り</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">珈琲職人</p>
          </div>
        </article>

        <article class="card card--light" data-tags="フローラル,ベリー系,華やか,酸味,爽やか">
          <div class="card__header">
            <h3 class="card__title">ケニアAAの華やかアロマ</h3>
            <span class="card__roast card__roast--light">浅煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="フローラル">フローラル</span>
              <span class="card__tag" data-tag="ベリー系">ベリー系</span>
              <span class="card__tag" data-tag="華やか">華やか</span>
              <span class="card__tag" data-tag="酸味">酸味</span>
              <span class="card__tag" data-tag="爽やか">爽やか</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">COFFEE LAB</p>
          </div>
        </article>

        <article
          class="card card--medium"
          data-tags="ナッツ,キャラメル,マイルド,バランス,毎日向け,飲みやすい"
        >
          <div class="card__header">
            <h3 class="card__title">コロンビアのバランス重視レシピ</h3>
            <span class="card__roast card__roast--medium">中煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="ナッツ">ナッツ</span>
              <span class="card__tag" data-tag="キャラメル">キャラメル</span>
              <span class="card__tag" data-tag="マイルド">マイルド</span>
              <span class="card__tag" data-tag="バランス">バランス</span>
              <span class="card__tag" data-tag="毎日向け">毎日向け</span>
              <span class="card__tag" data-tag="飲みやすい">飲みやすい</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Morning Brew</p>
          </div>
        </article>

        <article class="card card--extra-dark" data-tags="スモーキー,ビター,濃厚,エスプレッソ向け">
          <div class="card__header">
            <h3 class="card__title">イタリアンローストの極上エスプレッソ</h3>
            <span class="card__roast card__roast--extra-dark">極深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="スモーキー">スモーキー</span>
              <span class="card__tag" data-tag="ビター">ビター</span>
              <span class="card__tag" data-tag="濃厚">濃厚</span>
              <span class="card__tag" data-tag="エスプレッソ向け">エスプレッソ向け</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Espresso Master</p>
          </div>
        </article>

        <article class="card card--medium-dark" data-tags="チョコレート,甘み,コク">
          <div class="card__header">
            <h3 class="card__title">ブラジル サントスの甘み引き出す</h3>
            <span class="card__roast card__roast--medium-dark">中深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="チョコレート">チョコレート</span>
              <span class="card__tag" data-tag="甘み">甘み</span>
              <span class="card__tag" data-tag="コク">コク</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Cafe Noir</p>
          </div>
        </article>

        <article
          class="card card--medium-light"
          data-tags="ジャスミン,ピーチ,フローラル,繊細,エレガント,紅茶のような"
        >
          <div class="card__header">
            <h3 class="card__title">ゲイシャ種の繊細な風味を活かす</h3>
            <span class="card__roast card__roast--medium-light">中浅煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="ジャスミン">ジャスミン</span>
              <span class="card__tag" data-tag="ピーチ">ピーチ</span>
              <span class="card__tag" data-tag="フローラル">フローラル</span>
              <span class="card__tag" data-tag="繊細">繊細</span>
              <span class="card__tag" data-tag="エレガント">エレガント</span>
              <span class="card__tag" data-tag="紅茶のような">紅茶のような</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Specialty Coffee Tokyo</p>
          </div>
        </article>

        <article
          class="card card--light"
          data-tags="シトラス,紅茶のような,爽やか,明るい酸味,クリーン,華やか"
        >
          <div class="card__header">
            <h3 class="card__title">パナマ産の爽やかな朝の一杯</h3>
            <span class="card__roast card__roast--light">浅煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="シトラス">シトラス</span>
              <span class="card__tag" data-tag="紅茶のような">紅茶のような</span>
              <span class="card__tag" data-tag="爽やか">爽やか</span>
              <span class="card__tag" data-tag="明るい酸味">明るい酸味</span>
              <span class="card__tag" data-tag="クリーン">クリーン</span>
              <span class="card__tag" data-tag="華やか">華やか</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Light Roast Fan</p>
          </div>
        </article>

        <article class="card card--dark" data-tags="ダークチョコ,ロースト感,ビター">
          <div class="card__header">
            <h3 class="card__title">グアテマラ深煎りの重厚な一杯</h3>
            <span class="card__roast card__roast--dark">深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="ダークチョコ">ダークチョコ</span>
              <span class="card__tag" data-tag="ロースト感">ロースト感</span>
              <span class="card__tag" data-tag="ビター">ビター</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">珈琲屋たろう</p>
          </div>
        </article>

        <article class="card card--medium" data-tags="バランス,飲みやすい,毎日向け">
          <div class="card__header">
            <h3 class="card__title">毎朝飲みたい定番レシピ</h3>
            <span class="card__roast card__roast--medium">中煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="バランス">バランス</span>
              <span class="card__tag" data-tag="飲みやすい">飲みやすい</span>
              <span class="card__tag" data-tag="毎日向け">毎日向け</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Coffee Daily</p>
          </div>
        </article>

        <article class="card card--extra-dark" data-tags="ミルクに合う,パンチ,濃厚,ラテ向け">
          <div class="card__header">
            <h3 class="card__title">カフェラテに最適な濃厚ベース</h3>
            <span class="card__roast card__roast--extra-dark">極深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="ミルクに合う">ミルクに合う</span>
              <span class="card__tag" data-tag="パンチ">パンチ</span>
              <span class="card__tag" data-tag="濃厚">濃厚</span>
              <span class="card__tag" data-tag="ラテ向け">ラテ向け</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Latte Art Studio</p>
          </div>
        </article>

        <article class="card card--medium-dark" data-tags="ハチミツ,まろやか,甘み,コク,ナッツ">
          <div class="card__header">
            <h3 class="card__title">コスタリカ ハニー製法の甘み</h3>
            <span class="card__roast card__roast--medium-dark">中深煎り</span>
          </div>
          <div class="card__tags-wrapper">
            <div class="card__tags-visible">
              <span class="card__tag" data-tag="ハチミツ">ハチミツ</span>
              <span class="card__tag" data-tag="まろやか">まろやか</span>
              <span class="card__tag" data-tag="甘み">甘み</span>
              <span class="card__tag" data-tag="コク">コク</span>
              <span class="card__tag" data-tag="ナッツ">ナッツ</span>
            </div>
            <span class="card__expand"
              >他<span class="card__expand-count">0</span>件
              <span class="card__expand-icon">▼</span></span
            >
            <div class="card__dropdown">
              <div class="card__dropdown-tags"></div>
            </div>
          </div>
          <div class="card__footer">
            <p class="card__author">Honey Process Lab</p>
          </div>
        </article>

        <!-- 結果なし表示用 -->
        <div class="no-results" id="noResults" style="display: none">
          <div class="no-results__icon">☕</div>
          <p class="no-results__text">該当するレシピがありません</p>
        </div>
      </div>
    </section>

    <script>
      // 選択中のタグを管理
      let activeFilters = [];

      const filterBar = document.getElementById('filterBar');
      const cardGrid = document.getElementById('cardGrid');
      const noResults = document.getElementById('noResults');

      // 2行を超えるかチェックして「他N件」を動的に表示
      function checkTagOverflow() {
        const wrappers = document.querySelectorAll('#cardGrid .card__tags-wrapper');

        wrappers.forEach((wrapper) => {
          const visible = wrapper.querySelector('.card__tags-visible');
          const dropdown = wrapper.querySelector('.card__dropdown-tags');
          const countEl = wrapper.querySelector('.card__expand-count');
          const tags = visible.querySelectorAll('.card__tag');

          // 一旦リセット
          wrapper.classList.remove('has-overflow');
          tags.forEach((tag) => (tag.style.display = ''));
          dropdown.innerHTML = '';

          // max-height を一時的に解除して実際の高さを測定
          const originalMaxHeight = visible.style.maxHeight;
          visible.style.maxHeight = 'none';
          const fullHeight = visible.scrollHeight;
          visible.style.maxHeight = originalMaxHeight || '56px';

          const maxHeight = 56; // 2行分の高さ

          if (fullHeight > maxHeight) {
            // どのタグまで表示できるか計算
            let hiddenTags = [];

            // パディング分を考慮して再計算
            visible.style.maxHeight = 'none';

            // 右側パディングを適用した状態で再測定
            const expandWidth = 52;
            const visibleWidth = visible.offsetWidth - expandWidth;

            let rowWidth = 0;
            let rows = 1;

            tags.forEach((tag, index) => {
              const tagWidth = tag.offsetWidth + 6; // gap分

              if (rowWidth + tagWidth > visibleWidth && rowWidth > 0) {
                rows++;
                rowWidth = tagWidth;
              } else {
                rowWidth += tagWidth;
              }

              if (rows > 2) {
                tag.style.display = 'none';
                hiddenTags.push(tag);
              }
            });

            visible.style.maxHeight = '56px';

            // 隠れたタグがある場合のみ「他N件」を表示
            if (hiddenTags.length > 0) {
              wrapper.classList.add('has-overflow');

              // 隠れたタグをドロップダウンに追加
              hiddenTags.forEach((tag) => {
                const clone = tag.cloneNode(true);
                clone.style.display = '';
                dropdown.appendChild(clone);
              });

              // カウント更新
              countEl.textContent = hiddenTags.length;
            }
          }
        });
      }

      // フィルターバーを更新
      function updateFilterBar() {
        if (activeFilters.length === 0) {
          filterBar.innerHTML = '<div class="filter-bar--empty">タグをクリックして絞り込み</div>';
        } else {
          let html = '<p class="filter-bar__label">絞り込み中</p><div class="filter-bar__tags">';
          activeFilters.forEach((tag) => {
            html += `<span class="filter-bar__tag" data-remove="${tag}">${tag}<span class="filter-bar__tag-remove">×</span></span>`;
          });
          html += '<span class="filter-bar__clear" id="clearAll">すべて解除</span></div>';
          filterBar.innerHTML = html;

          filterBar.querySelectorAll('.filter-bar__tag').forEach((el) => {
            el.addEventListener('click', () => {
              const tag = el.dataset.remove;
              removeFilter(tag);
            });
          });

          document.getElementById('clearAll')?.addEventListener('click', clearAllFilters);
        }
      }

      // カードをフィルタリング
      function filterCards() {
        const cards = cardGrid.querySelectorAll('.card');
        let visibleCount = 0;

        cards.forEach((card) => {
          const cardTags = card.dataset.tags?.split(',') || [];
          const matches = activeFilters.every((filter) => cardTags.includes(filter));

          if (activeFilters.length === 0 || matches) {
            card.classList.remove('is-hidden');
            visibleCount++;
          } else {
            card.classList.add('is-hidden');
          }
        });

        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
      }

      function addFilter(tag) {
        if (!activeFilters.includes(tag)) {
          activeFilters.push(tag);
          updateFilterBar();
          filterCards();
        }
      }

      function removeFilter(tag) {
        activeFilters = activeFilters.filter((t) => t !== tag);
        updateFilterBar();
        filterCards();
      }

      function clearAllFilters() {
        activeFilters = [];
        updateFilterBar();
        filterCards();
      }

      // タグクリックイベント
      cardGrid.addEventListener('click', (e) => {
        const tag = e.target.closest('.card__tag');
        if (tag && tag.dataset.tag) {
          e.stopPropagation();
          addFilter(tag.dataset.tag);
        }
      });

      // ドロップダウン トグル
      document.querySelectorAll('#cardGrid .card__expand').forEach((btn) => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const wrapper = btn.closest('.card__tags-wrapper');
          const dropdown = wrapper.querySelector('.card__dropdown');

          document.querySelectorAll('.card__dropdown.is-open').forEach((d) => {
            if (d !== dropdown) {
              d.classList.remove('is-open');
              d.closest('.card__tags-wrapper')
                .querySelector('.card__expand')
                .classList.remove('is-open');
            }
          });

          btn.classList.toggle('is-open');
          dropdown.classList.toggle('is-open');
        });
      });

      // 外側クリックでドロップダウンを閉じる
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.card__tags-wrapper')) {
          document.querySelectorAll('.card__dropdown.is-open').forEach((d) => {
            d.classList.remove('is-open');
            d.closest('.card__tags-wrapper')
              .querySelector('.card__expand')
              .classList.remove('is-open');
          });
        }
      });

      // 初期化
      updateFilterBar();

      // DOM読み込み後とリサイズ時に溢れチェック
      window.addEventListener('load', checkTagOverflow);
      window.addEventListener('resize', checkTagOverflow);

      // 少し遅延させて確実に実行
      setTimeout(checkTagOverflow, 100);
    </script>
  </body>
</html>
