# DDD Implementation Strategy

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### èƒŒæ™¯

Coffee Recipe Collectionãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã„ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’DDDï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆï¼‰/ã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ç§»è¡Œã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

### æ¡ç”¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ãƒ—ãƒ©ã‚°ãƒãƒ†ã‚£ãƒƒã‚¯DDD** - å®Œå…¨ãªã‚ªãƒ‹ã‚ªãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯éå‰°ã¨åˆ¤æ–­ã—ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦æ¨¡ã«é©ã—ãŸç¾å®Ÿçš„ãªDDDå®Ÿè£…ã‚’é¸æŠã€‚

### æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

- **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š**: ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¢ãƒƒã‚¯åŒ–ã«ã‚ˆã‚‹å˜ä½“ãƒ†ã‚¹ãƒˆå®¹æ˜“åŒ–
- **ä¿å®ˆæ€§å‘ä¸Š**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®é›†ç´„ã¨è²¬ä»»åˆ†é›¢
- **å‹å®‰å…¨æ€§å¼·åŒ–**: Zodã«ã‚ˆã‚‹å®£è¨€çš„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **æ‹¡å¼µæ€§å‘ä¸Š**: æ–°æ©Ÿèƒ½è¿½åŠ ã®å®¹æ˜“ã•

---

## ğŸ“Š æ—¢å­˜ã‚³ãƒ¼ãƒ‰åˆ†æçµæœ

### ç™ºè¦‹ã•ã‚ŒãŸä¸»è¦èª²é¡Œ

#### 1. ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®è²¬ä»»è‚¥å¤§åŒ–

**å•é¡Œ**: `src/server/features/recipe/detail/service.ts`ã§ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¨ã‚¤ãƒ³ãƒ•ãƒ©é–¢å¿ƒäº‹ãŒæ··åœ¨

```typescript
// ğŸ”´ èª²é¡Œ: ãƒ“ãƒ¥ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ ãƒ­ã‚¸ãƒƒã‚¯ãŒã‚µãƒ¼ãƒ“ã‚¹å±¤ã«æ··åœ¨
export async function getRecipeDetail(id: number): Promise<GetRecipeDetailResult> {
  // ãƒ‡ãƒ¼ã‚¿å–å¾—
  const recipe = await prisma.post.findFirst({ ... });

  // ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆæœ¬æ¥ã¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è²¬ä»»ï¼‰
  if (!recipe.isPublished) {
    throw new RecipeDetailError('Recipe is not published', 'RECIPE_NOT_PUBLISHED', 403);
  }

  // å‰¯ä½œç”¨å‡¦ç†ï¼ˆæœ¬æ¥ã¯åˆ¥ã®è²¬ä»»ï¼‰
  const updatedRecipe = await prisma.post.update({
    where: { id: BigInt(id) },
    data: { viewCount: { increment: 1 } },
  });
}
```

#### 2. ã‚¤ãƒ³ãƒ•ãƒ©ä¾å­˜ã«ã‚ˆã‚‹ä½ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£

**å•é¡Œ**: Prismaã¸ã®ç›´æ¥ä¾å­˜ã§ãƒ¢ãƒƒã‚¯åŒ–ãŒå›°é›£

```typescript
// ğŸ”´ èª²é¡Œ: ã‚µãƒ¼ãƒ“ã‚¹å±¤ãŒPrismaã«ç›´æ¥ä¾å­˜
import { prisma } from '@/server/shared/database/prisma';

export class SearchRecipesService {
  async searchRecipes(params: SearchRecipesParams): Promise<SearchRecipesResult> {
    // Prismaã«ç›´æ¥ä¾å­˜ï¼ˆãƒ†ã‚¹ãƒˆã§ãƒ¢ãƒƒã‚¯åŒ–å›°é›£ï¼‰
    const [totalCount, posts] = await Promise.all([
      prisma.post.count({ where }),
      prisma.post.findMany({ ... })
    ]);
  }
}
```

#### 3. ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ä¸åœ¨

**å•é¡Œ**: DTOã®ã¿ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒå­˜åœ¨ã—ãªã„

```typescript
// ğŸ”´ èª²é¡Œ: å˜ç´”ãªãƒ‡ãƒ¼ã‚¿è»¢é€ã®ã¿ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«åˆ†æ•£
export type RecipeDetail = {
  id: string;
  title: string;
  // ... ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã¿ã€ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆæŒ¯ã‚‹èˆã„ï¼‰ãªã—
};
```

#### 4. æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èª²é¡Œ

**å•é¡Œ**: å‹å®‰å…¨æ€§ä¸è¶³ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸€è²«æ€§æ¬ å¦‚

```typescript
// ğŸ”´ èª²é¡Œ: æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€å‹å®‰å…¨æ€§ä¸è¶³
if (!title || title.trim().length === 0) {
  throw new Error('Recipe title is required');
}
if (title.length > 200) {
  throw new Error('Recipe title must be 200 characters or less');
}
```

---

## ğŸ—ï¸ ç›®æ¨™ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹é€ 

```
src/server/
â”œâ”€â”€ domain/                          # ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤
â”‚   â””â”€â”€ recipe/
â”‚       â”œâ”€â”€ entities/
â”‚       â”‚   â”œâ”€â”€ Recipe.entity.ts     # ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é›†ç´„
â”‚       â”‚   â”œâ”€â”€ Barista.entity.ts    # ãƒãƒªã‚¹ã‚¿ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚       â”‚   â””â”€â”€ Equipment.entity.ts  # å™¨å…·ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚       â”œâ”€â”€ value-objects/
â”‚       â”‚   â”œâ”€â”€ RecipeId.ts          # IDå‹å®‰å…¨æ€§
â”‚       â”‚   â””â”€â”€ BrewingConditions.ts # æŠ½å‡ºæ¡ä»¶
â”‚       â””â”€â”€ repositories/
â”‚           â””â”€â”€ IRecipeRepository.ts # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚
â”œâ”€â”€ application/                     # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤
â”‚   â”œâ”€â”€ use-cases/
â”‚   â”‚   â”œâ”€â”€ GetRecipeDetailUseCase.ts    # ãƒ“ã‚¸ãƒã‚¹æ“ä½œé›†ç´„
â”‚   â”‚   â””â”€â”€ SearchRecipesUseCase.ts      # æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯é›†ç´„
â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ RecipeDetailResponse.ts      # å¤–éƒ¨å¢ƒç•ŒDTO
â”‚       â””â”€â”€ SearchRecipesResponse.ts     # ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼å®šç¾©
â”‚
â”œâ”€â”€ infrastructure/                  # ã‚¤ãƒ³ãƒ•ãƒ©å±¤
â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”œâ”€â”€ PrismaRecipeRepository.ts    # Prismaå…·è±¡å®Ÿè£…
â”‚   â”‚   â””â”€â”€ MemoryRecipeRepository.ts    # ãƒ†ã‚¹ãƒˆç”¨å®Ÿè£…
â”‚   â””â”€â”€ database/
â”‚       â””â”€â”€ prisma.ts                    # DBæ¥ç¶šç®¡ç†
â”‚
â”œâ”€â”€ features/ (æ—¢å­˜)                 # æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ®µéšçš„ç§»è¡Œï¼‰
â”‚   â”œâ”€â”€ recipe/detail/               # æ®µéšç§»è¡Œäºˆå®š
â”‚   â”‚   â”œâ”€â”€ controller.ts
â”‚   â”‚   â”œâ”€â”€ service.ts               # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¸ç§»è¡Œäºˆå®š
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â””â”€â”€ recipes/search/              # æ®µéšç§»è¡Œäºˆå®š
â”‚       â”œâ”€â”€ controller.ts
â”‚       â”œâ”€â”€ service.ts               # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¸ç§»è¡Œäºˆå®š
â”‚       â””â”€â”€ types.ts
â”‚
â””â”€â”€ shared/ (æ—¢å­˜)                   # å…±æœ‰ã‚³ãƒ¼ãƒ‰
    â”œâ”€â”€ api-error.ts
    â”œâ”€â”€ logger.ts
    â”œâ”€â”€ database/
    â”‚   â””â”€â”€ prisma.ts
    â””â”€â”€ types/
        â”œâ”€â”€ api-response.ts
        â”œâ”€â”€ pagination.ts
        â””â”€â”€ primitives.ts
```

---

## ğŸ”§ æŠ€è¡“çš„æ”¹å–„æˆ¦ç•¥

### Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¡ç”¨

**å¾“æ¥**: æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€å‹å®‰å…¨æ€§ä¸è¶³

```typescript
// ğŸ”´ Before: æ‰‹å‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
if (!title || title.trim().length === 0) {
  throw new Error('Recipe title is required');
}
```

**æ”¹å–„å¾Œ**: å®£è¨€çš„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€å‹å®‰å…¨æ€§å‘ä¸Š

```typescript
// âœ… After: Zodã«ã‚ˆã‚‹å®£è¨€çš„ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const RecipeCreateSchema = z.object({
  title: z
    .string()
    .trim()
    .min(1, 'Recipe title is required')
    .max(200, 'Recipe title must be 200 characters or less'),
});
```

### ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é›†ç´„

**å¾“æ¥**: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã«æ•£åœ¨

```typescript
// ğŸ”´ Before: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«å‡¦ç†
if (!recipe.isPublished) {
  throw new RecipeDetailError('Recipe is not published', 'RECIPE_NOT_PUBLISHED', 403);
}
```

**æ”¹å–„å¾Œ**: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«é›†ç´„

```typescript
// âœ… After: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã§ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ç®¡ç†
recipe.incrementViewCount(); // ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒè²¬ä»»ã‚’æŒã¤
```

### ä¾å­˜é–¢ä¿‚é€†è»¢ã®åŸå‰‡

**å¾“æ¥**: ã‚µãƒ¼ãƒ“ã‚¹å±¤ãŒã‚¤ãƒ³ãƒ•ãƒ©ã«ç›´æ¥ä¾å­˜

```typescript
// ğŸ”´ Before: ç›´æ¥ä¾å­˜
import { prisma } from '@/server/shared/database/prisma';
const recipe = await prisma.post.findFirst(...);
```

**æ”¹å–„å¾Œ**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã‚‹æŠ½è±¡åŒ–

```typescript
// âœ… After: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä¾å­˜
constructor(private recipeRepository: IRecipeRepository) {}
const recipe = await this.recipeRepository.findById(id);
```

---

## ğŸ“‹ æ®µéšçš„ç§»è¡Œæˆ¦ç•¥

### Phase 1: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«å°å…¥ âœ…å®Œäº†

- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ValueObjectã®å®Ÿè£…
- ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®šç¾©
- Zodãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒã®å°å…¥
- YAGNIåŸå‰‡é©ç”¨ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ç°¡ç´ åŒ–

### Phase 2: ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³å°å…¥ï¼ˆ3-4æ—¥äºˆå®šï¼‰

- Prismaãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…ã®ä½œæˆ
- ãƒ†ã‚¹ãƒˆç”¨ãƒ¡ãƒ¢ãƒªãƒªãƒã‚¸ãƒˆãƒªã®å®Ÿè£…
- æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹å±¤ã¨ã®ä¸¦è¡Œé‹ç”¨
- æ®µéšçš„ãªãƒªãƒã‚¸ãƒˆãƒªå‘¼ã³å‡ºã—ç§»è¡Œ

### Phase 3: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹åˆ†é›¢ï¼ˆ2-3æ—¥äºˆå®šï¼‰

- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å±¤ã®å®Ÿè£…
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¹ãƒªãƒ åŒ–
- æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‹ã‚‰ã®å®Œå…¨ç§»è¡Œ

---

## ğŸ¯ å“è³ªä¿è¨¼æ–¹é‡

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**: ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«
2. **çµ±åˆãƒ†ã‚¹ãƒˆ**: ãƒªãƒã‚¸ãƒˆãƒªã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–“ã®æ•´åˆæ€§

### YAGNIåŸå‰‡ã®é©ç”¨

ç¾åœ¨ã®è¦ä»¶ã«å¿…è¦ã®ãªã„æ©Ÿèƒ½ã¯å®Ÿè£…ã›ãšã€å°†æ¥å¿…è¦ã«ãªã£ãŸæ™‚ç‚¹ã§è¿½åŠ ã™ã‚‹æ–¹é‡ã‚’æ¡ç”¨ã€‚

### ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

```bash
npm run format  # Prettierå®Ÿè¡Œ
npm run lint    # ESLintå®Ÿè¡Œ
npx tsc --noEmit # å‹ãƒã‚§ãƒƒã‚¯
npm test        # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```

---

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœã¨æˆæœ

### æŠ€è¡“çš„åˆ©ç›Š

- **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: 90%å‘ä¸Šï¼ˆãƒªãƒã‚¸ãƒˆãƒªãƒ¢ãƒƒã‚¯åŒ–ï¼‰
- **ä¿å®ˆæ€§**: è²¬ä»»åˆ†é›¢ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ç†è§£å®¹æ˜“åŒ–
- **å‹å®‰å…¨æ€§**: Zodã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–
- **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å½±éŸ¿ç¯„å›²é™å®š

### ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤

- **ãƒã‚°æ¸›å°‘**: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«æ˜ç¢ºåŒ–ã«ã‚ˆã‚‹
- **é–‹ç™ºé€Ÿåº¦**: è²¬ä»»æ˜ç¢ºåŒ–ã«ã‚ˆã‚‹
- **å“è³ªå‘ä¸Š**: è‡ªå‹•ãƒ†ã‚¹ãƒˆå®¹æ˜“åŒ–ã«ã‚ˆã‚‹
