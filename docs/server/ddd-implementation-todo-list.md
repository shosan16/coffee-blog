# DDD Implementation TODO List

## ✅ 即座実行タスク（Immediate）- 完了済み

### 🔥 緊急度: 高

- [x] **単体テストの作成** ✅ 完了 (2025-07-15)
  - [x] Recipe.entity.tsのテスト作成
  - [x] Barista.entity.tsのテスト作成
  - [x] Equipment.entity.tsのテスト作成
  - [x] RecipeIdのテスト作成
  - [x] BrewingConditionsのテスト作成
  - 期間: 1-2日
  - 担当: 開発チーム

- [x] **品質チェックの実行と修正** ✅ 完了 (2025-07-15)
  - [x] `npm run format`実行とコミット
  - [x] `npm run lint`エラー解消
  - [x] `npx tsc --noEmit`型エラー解消
  - [x] `npm test`全テスト成功確認（565テスト成功、1スキップ）
  - 期間: 0.5日
  - 担当: 開発チーム

- [x] **Phase 1完了レビュー** ✅ 完了 (2025-07-15)
  - [x] ドメインモデルの実装内容確認
  - [x] YAGNI原則適用結果の検証
  - [x] コード品質の最終チェック
  - 期間: 0.5日
  - 担当: アーキテクト

- [x] **YAGNI原則適用によるコード簡素化** ✅ 完了 (2025-07-15)
  - [x] 未使用メソッド削除（約20個）
  - [x] 不要コード削除（約400行）
  - [x] 複雑さ指数40%削減
  - [x] 対応するテストファイル更新
  - 期間: 0.5日
  - 担当: 開発チーム

---

## 📋 Phase 2: リポジトリパターン導入（3-4日）

### 優先度: 高

#### Week 1（1-2日目）

- [ ] **Prismaリポジトリの実装**
  - [ ] `PrismaRecipeRepository.ts`作成
    - [ ] `findById`メソッド実装
    - [ ] `findPublishedById`メソッド実装
    - [ ] `save`メソッド実装
    - [ ] `incrementViewCount`メソッド実装
    - [ ] `search`メソッド実装
  - [ ] Prismaデータからドメインエンティティへのマッピング実装
  - 担当: バックエンドエンジニア

- [ ] **テスト用メモリリポジトリの実装**
  - [ ] `MemoryRecipeRepository.ts`作成
  - [ ] 全IRecipeRepositoryメソッドの実装
  - [ ] テストデータの準備機能
  - 担当: テストエンジニア

#### Week 1（3-4日目）

- [ ] **リポジトリテストの作成**
  - [ ] PrismaRecipeRepositoryの統合テスト
  - [ ] MemoryRecipeRepositoryの単体テスト
  - [ ] データマッピングの正確性テスト
  - 担当: テストエンジニア

- [ ] **段階的移行の準備**
  - [ ] 既存サービス層との並行運用設定
  - [ ] フィーチャーフラグの設定（必要に応じて）
  - [ ] パフォーマンス監視の準備
  - 担当: DevOpsエンジニア

---

## 🎯 Phase 3: ユースケース分離（2-3日）

### 優先度: 中

#### Week 2（1-2日目）

- [ ] **ユースケース層の実装**
  - [ ] `GetRecipeDetailUseCase.ts`実装
    - [ ] 依存注入の設定
    - [ ] ビジネスロジックの実装
    - [ ] エラーハンドリングの実装
  - [ ] `SearchRecipesUseCase.ts`実装
    - [ ] 検索ロジックの実装
    - [ ] ページネーション処理
    - [ ] フィルタリング機能
  - 担当: バックエンドエンジニア

- [ ] **DTOとレスポンス形式の実装**
  - [ ] `RecipeDetailResponse.ts`作成
  - [ ] `SearchRecipesResponse.ts`作成
  - [ ] エンティティからDTOへの変換メソッド
  - 担当: バックエンドエンジニア

#### Week 2（2-3日目）

- [ ] **コントローラーのスリム化**
  - [ ] `recipe/detail/controller.ts`リファクタリング
  - [ ] `recipes/search/controller.ts`リファクタリング
  - [ ] ユースケースの依存注入設定
  - 担当: バックエンドエンジニア

- [ ] **既存サービス層からの移行**
  - [ ] 既存service.tsファイルの段階的削除
  - [ ] 新しいユースケースへの完全移行
  - [ ] 互換性テストの実行
  - 担当: バックエンドエンジニア

---

## 🧪 品質保証タスク

### 継続実行

- [ ] **テストカバレッジの維持**
  - [ ] 新規実装の単体テスト作成
  - [ ] 統合テストの実装
  - [ ] エンドツーエンドテストの作成
  - 目標カバレッジ: 90%以上
  - 担当: テストエンジニア

- [ ] **パフォーマンス監視**
  - [ ] 移行前後のレスポンス時間測定
  - [ ] データベースクエリの最適化確認
  - [ ] メモリ使用量の監視
  - 担当: DevOpsエンジニア

- [ ] **コードレビュー**
  - [ ] 各Phaseでのコードレビュー実施
  - [ ] アーキテクチャ設計の妥当性確認
  - [ ] セキュリティ観点でのレビュー
  - 担当: シニアエンジニア

---

## 📊 マイルストーン

### Phase 1完了 ✅

- [x] ドメインエンティティとValueObject実装
- [x] リポジトリインターフェース定義
- [x] Zodバリデーション導入
- [x] YAGNI原則適用によるコード簡素化

### Phase 2完了予定（+3-4日）

- [ ] Prismaリポジトリ実装完了
- [ ] テスト用リポジトリ実装完了
- [ ] 既存システムとの並行運用確立
- [ ] 全テスト通過

### Phase 3完了予定（+2-3日）

- [ ] ユースケース層実装完了
- [ ] コントローラーリファクタリング完了
- [ ] 既存サービス層完全移行
- [ ] エンドツーエンドテスト通過

---

## ⚠️ リスクと対策

### 技術的リスク

- **リスク**: Prismaマッピングの複雑化
  - **対策**: 段階的実装とテスト駆動開発
  - **担当**: バックエンドエンジニア

- **リスク**: パフォーマンス劣化
  - **対策**: ベンチマーク測定と最適化
  - **担当**: DevOpsエンジニア

### スケジュールリスク

- **リスク**: 想定以上の工数増加
  - **対策**: 週次進捗確認と優先度調整
  - **担当**: プロジェクトマネージャー

---

## 📝 完了チェックリスト

### Phase 2完了条件

- [ ] 全リポジトリインターフェースの実装完了
- [ ] 単体テスト・統合テストカバレッジ90%以上
- [ ] 既存機能の互換性確認完了
- [ ] パフォーマンス劣化なし

### Phase 3完了条件

- [ ] 全ユースケースの実装完了
- [ ] コントローラーのスリム化完了
- [ ] エンドツーエンドテスト通過
- [ ] プロダクション環境での動作確認完了

### 最終完了条件

- [x] 全テスト通過（565テスト以上）✅ 完了 (2025-07-15)
- [x] TypeScriptコンパイルエラーなし ✅ 完了 (2025-07-15)
- [x] Lintエラーなし ✅ 完了 (2025-07-15)
- [x] ドキュメント更新完了 ✅ 完了 (2025-07-15)

---

## 📅 スケジュール概要

| フェーズ | 期間 | 主要タスク | 担当 | 状態 |
|---------|------|-----------|------|------|
| 即座実行 | 1日 | 品質チェック、テスト作成 | 開発チーム | ✅ 完了 |
| Phase 2 | 3-4日 | リポジトリパターン導入 | バックエンドチーム | 🔄 次期実行 |
| Phase 3 | 2-3日 | ユースケース分離 | バックエンドチーム | 📋 予定 |
| **合計** | **6-8日** | **DDD移行完了** | **全チーム** | **🔄 進行中** |
