# システムパターン

本プロジェクトは、Next.js の AppRouter 機能と、[bulletproof-react](https://github.com/pomber/bulletproof-react) のベストプラクティスに基づいたアーキテクチャを採用しています。本ドキュメントでは、全体の設計方針と各層の役割、フォルダ構成、エラーハンドリング、テスト戦略などについて記述します。

---

## 1. Next.js AppRouter の活用

- **ファイルベースルーティング:**
  - `/app` ディレクトリを利用してページやレイアウトを定義。
  - 各ルートに対して、専用のエラーバウンダリやローディングコンポーネントを設定。

- **サーバーコンポーネントとクライアントコンポーネントの役割分離:**
  - **サーバーコンポーネント:**
    初期データのフェッチ、SEO 対策、レンダリングを担当。
  - **クライアントコンポーネント:**
    ユーザーインタラクション、動的な UI の制御を担当。

- **エラーハンドリングとローディング:**
  各ルートで Next.js のエラーバウンダリとローディング UI を適切に配置し、ユーザー体験の向上を図る。

---

## 2. bulletproof-react に基づく設計パターン

- **機能別フォルダ構成:**
  アプリケーションを機能（ドメイン）ごとに分割し、各機能内に以下のサブフォルダを配置します:
  - `components/`
    UI（Presentational）コンポーネントを配置。
  - `containers/`
    ビジネスロジック、データフェッチ、状態管理を担当するコンテナコンポーネントを配置。
  - `hooks/`
    再利用可能なカスタムフックを管理。
  - `types/`
    TypeScript の型定義を集約。
  - `utils/`
    ユーティリティ関数やサービス層のロジックを配置。
  - `__tests__/`
    各機能ごとのテストコードを格納。

- **Container / Presentational 分離:**
  ビジネスロジックと UI を明確に分離することで、テスト容易性と再利用性を向上させます。

- **TypeScript の徹底:**
  型安全性を確保するため、全体で TypeScript を活用し、各モジュールで適切な型定義を実施します。

---

## 3. API 層とデータフェッチ戦略

- **Next.js API ルートの活用:**
  - サーバー側でデータ取得や更新処理を担当する API エンドポイントは、`/app/api` 配下に実装します。

- **データフェッチ:**
  - サーバーコンポーネントで初期データの取得を行い、クライアント側では必要に応じて SWR や React Query などのライブラリを併用し、データの再検証やキャッシュ管理を実施します。

---

## 4. テストと品質保証

- **テスト戦略:**
  - 各機能ごとにユニットテストおよび統合テストを配置し、システム全体の堅牢性を保証します。

- **コード品質ツール:**
  - Prettier、ESLint などを利用して、コードの一貫性と品質を維持します。

---

## まとめ

このシステムパターンは、Next.js AppRouter の先進機能と、bulletproof-react のモジュール化アプローチを組み合わせることで、以下のメリットを提供します：

- **保守性と拡張性:**
  機能単位でのフォルダ構成により、開発効率と再利用性が向上。

- **パフォーマンスと SEO:**
  サーバーコンポーネントの活用により、初期レンダリングの高速化と SEO 効果の最大化。

- **テスト容易性:**
  ビジネスロジックと UI の分離により、各層ごとのテストが容易に実施可能。

このアーキテクチャにより、当プロジェクトはスケーラブルかつ堅牢な基盤の上に構築され、今後の機能追加や改善が円滑に進むことが期待されます。
